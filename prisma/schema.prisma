// Offsets - Collaborative Literary Project
// Database schema for nodes and their tree structure

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Iteration {
  id          String   @id @default(cuid())
  name        String   // e.g., "Iteration 1", "Spring 2025"
  description String?  // Optional description
  startDate   DateTime @default(now())
  endDate     DateTime? // When iteration was concluded
  isActive    Boolean  @default(true)

  nodes       Node[]

  @@index([isActive])
}

model Node {
  id        String   @id @default(cuid())
  content   String   // The literary content (no length limit)
  authorName String  // Player's name (hidden until withered)

  // Node lifecycle
  status    NodeStatus @default(PENDING)
  createdAt DateTime   @default(now())
  publishedAt DateTime? // When admin approved and published

  // Tree structure
  parentId  String?
  parent    Node?   @relation("NodeToNode", fields: [parentId], references: [id])
  children  Node[]  @relation("NodeToNode")

  // Withering tracking
  lastResponseAt DateTime? // Last time a child was added
  witheredAt     DateTime? // When node died (3 days no responses)

  // Iteration tracking
  iterationId String
  iteration   Iteration @relation(fields: [iterationId], references: [id])

  @@index([status])
  @@index([parentId])
  @@index([publishedAt])
  @@index([iterationId])
}

enum NodeStatus {
  PENDING    // Awaiting admin approval
  LIVE       // Published and can receive responses
  WITHERED   // Died (no responses for 3 days), author revealed
  REJECTED   // Admin rejected (optional, for future use)
}

model SiteSettings {
  id                String   @id @default("default")

  // Hero section
  heroTitle         String   @default("Offsets")
  heroSubtitle      String   @default("A collaborative literary project where nodes of creative writing branch and grow like a tree")

  // How It Works section
  howItWorksTitle   String   @default("How It Works")
  step1Title        String   @default("1. Read & Respond")
  step1Description  String   @default("Browse live nodes and respond with your own creative writing. Your response can be any length and connect to the parent node through linguistic, conceptual, formal, or stylistic links.")
  step2Title        String   @default("2. Stay Anonymous")
  step2Description  String   @default("Your name stays hidden until your node \"withers\" - when it receives no responses for 3 days. This keeps the focus on the writing itself.")
  step3Title        String   @default("3. Branch & Grow")
  step3Description  String   @default("Each response creates a new branch in the tree. Multiple people can respond to the same node, creating a network of interconnected creative writing.")
  step4Title        String   @default("4. Admin Approval")
  step4Description  String   @default("All submissions are reviewed before publishing to maintain quality and intention. Once approved, your node goes live immediately.")

  // Rules section
  rulesTitle        String   @default("The Rules")
  rule1             String   @default("Any length: Your node can be a single word or a lengthy piece - there's no character limit.")
  rule2             String   @default("Any connection: Link to your parent node however you see fit - thematically, formally, linguistically, or conceptually.")
  rule3             String   @default("Withering period: If a live node receives no responses for 3 days, it \"withers\" and the author's name is revealed.")
  rule4             String   @default("No responses to withered nodes: Once a node has withered, it can no longer receive new responses.")
  rule5             String   @default("Submit your name: Enter your name with each submission - it will be revealed when your node withers.")

  updatedAt         DateTime @updatedAt
}
